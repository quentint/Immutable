<!DOCTYPE html>
<html>
<head>
    <title>innmind/immutable</title>
    <link rel="stylesheet" href="https://innmind.github.io/Immutable/static/main.css"/>
    <link rel="stylesheet" href="https://innmind.github.io/Immutable/static/styles/default.css"/>
    <link rel="stylesheet" href="https://innmind.github.io/Immutable/static/styles/atom-one-dark.css"/>
    <script src="https://innmind.github.io/Immutable/static/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
    <header>
        <a href="https://innmind.github.io/Immutable/"><code>immutable</code></a>
    </header>
    <aside>
        <ul>
                    <li>
                                    <a href="https://innmind.github.io/Immutable/index.html">
                        Getting started
                    </a>
                            </li>
                    <li>
                                    <details open>
                        <summary>
                                                            Structures
                                                    </summary>
                        <ul>
                                                            <li class="sub-item ">
                                    <a href="https://innmind.github.io/Immutable/SEQUENCE.html">
                                        Sequence
                                    </a>
                                </li>
                                                            <li class="sub-item ">
                                    <a href="https://innmind.github.io/Immutable/SET.html">
                                        Set
                                    </a>
                                </li>
                                                            <li class="sub-item ">
                                    <a href="https://innmind.github.io/Immutable/MAP.html">
                                        Map
                                    </a>
                                </li>
                                                            <li class="sub-item ">
                                    <a href="https://innmind.github.io/Immutable/STR.html">
                                        Str
                                    </a>
                                </li>
                                                            <li class="sub-item ">
                                    <a href="https://innmind.github.io/Immutable/REGEXP.html">
                                        RegExp
                                    </a>
                                </li>
                                                            <li class="sub-item ">
                                    <a href="https://innmind.github.io/Immutable/MAYBE.html">
                                        Maybe
                                    </a>
                                </li>
                                                            <li class="sub-item ">
                                    <a href="https://innmind.github.io/Immutable/EITHER.html">
                                        Either
                                    </a>
                                </li>
                                                            <li class="sub-item current">
                                    <a href="https://innmind.github.io/Immutable/STATE.html">
                                        State
                                    </a>
                                </li>
                                                            <li class="sub-item ">
                                    <a href="https://innmind.github.io/Immutable/MONOIDS.html">
                                        Monoids
                                    </a>
                                </li>
                                                    </ul>
                    </details>
                            </li>
                    <li>
                                    <details open>
                        <summary>
                                                            Use cases
                                                    </summary>
                        <ul>
                                                            <li class="sub-item ">
                                    <a href="https://innmind.github.io/Immutable/LAZY_FILE.html">
                                        How to read a file
                                    </a>
                                </li>
                                                            <li class="sub-item ">
                                    <a href="https://innmind.github.io/Immutable/PARSING.html">
                                        Parsing strings
                                    </a>
                                </li>
                                                    </ul>
                    </details>
                            </li>
                    <li>
                                    <a href="https://innmind.github.io/Immutable/BLACKBOX.html">
                        Blackbox
                    </a>
                            </li>
                    <li>
                                    <a href="https://innmind.github.io/Immutable/PHILOSOPHY.html">
                        Philosophy
                    </a>
                            </li>
                </ul>
    </aside>
    <main><h1 id="state"><a href="#state" class="anchor">#</a><code>State</code></h1>
<p>The <code>State</code> monad allows you to build a set of pure steps to compute a new state. Since the initial state is given when all the steps are built it means that all steps are lazy, this use function composition (so everything is kept in memory).</p>
<p>The state and value can be of any type.</p>
<h2 id="of"><a href="#of" class="anchor">#</a><code>::of()</code></h2>
<pre><code class="language-php">use Innmind\Immutable\{
    State,
    State\Result,
};

/** @var State<array, int> */
$state = State::of(function(array $logs) {
    return Result::of($logs, 0);
});</code></pre>
<h2 id="map"><a href="#map" class="anchor">#</a><code>->map()</code></h2>
<p>This method will modify the value without affecting the currently held state.</p>
<pre><code class="language-php">use Innmind\Immutable\{
    State,
    State\Result,
};

/** @var State<array, int> */
$state = State::of(function(array $logs) {
    return Result::of($logs, 0);
});

$state = $state->map(fn($value) => $value + 1);</code></pre>
<h2 id="flatmap"><a href="#flatmap" class="anchor">#</a><code>->flatMap()</code></h2>
<p>This method allows you to modify both state and values.</p>
<pre><code class="language-php">use Innmind\Immutable\{
    State,
    State\Result,
};

/** @var State<array, int> */
$state = State::of(function(array $logs) {
    return Result::of($logs, 0);
});

$state = $state->flatMap(fn($value) => State::of(function(array $logs) use ($value) {
    $value++;

    return Result::of(
        \array_merge($logs, "The new value is $value"),
        $value,
    );
}));</code></pre>
<h2 id="run"><a href="#run" class="anchor">#</a><code>->run()</code></h2>
<p>This is the only place where you can run the steps to compute the new state.</p>
<pre><code class="language-php">use Innmind\Immutable\{
    State,
    State\Result,
};

/** @var State<array, int> */
$result = State::of(function(array $logs) {
    return Result::of($logs, 0);
})
    ->map(fn($value) => $value + 1)
    ->flatMap(fn($value) => State::of(function(array $logs) use ($value) {
        $value++;

        return Result::of(
            \array_merge($logs, "The new value is $value"),
            $value,
        );
    }))
    ->run([]);

$result->state(); // ['The new value is 2']
$result->value(); // 2</code></pre></main>
    <footer>
        <a href="https://github.com/innmind/Immutable/" target="_blank">GitHub</a>
    </footer>
</body>
</html>